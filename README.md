# Система учёта работников компании

## Описание проекта:
Требовалось разработать внутреннюю систему для HR-отдела компании, которая позволит вести учёт работников: добавлять новых сотрудников, просматривать список, обновлять данные и управлять статусами. Система должна иметь REST API и админ-панель.

### Технический стек

  * Python 3.12
  * Django 4.2+ (LTS) + Django REST Framework
  * Poetry для управления зависимостями
  * БД (SQLite/PostgreSQL)
  * Postman для проверки работоспособности api

### REST API

**Endpoints:**
* GET /api/workers/ — список работников
* POST /api/workers/ — создание работника
* GET /api/workers/{id}/ — детальная информация
* PATCH /api/workers/{id}/ — обновление
* DELETE /api/workers/{id}/ — удаление
* POST /api/workers/import/ — импорт работников из Excel

**Другие технические характеристики API:**
* Пагинация списка (по 10 объектов на страницу)
* Список работников отображает только базовые поля (id, first_name, middle_name, last_name, position, is_active)
* Детальный просмотр включает все поля с email, hired_date, created_by
* Фильтрация по is_active и position
* Ролевая модель доступа:
    - User — только чтение (GET)
    - Admin — полный доступ (CRUD)
* Автоматическое заполнение created_by при создании
* Логирование при создании работника (и через API и через админку) выводом в консоль.

**Импорт из Excel:**
* Endpoint принимает Excel файл
* Валидация данных:
    - Проверяет обязательные поля
    - Валидирует email, проверяет наличие дубликатов
* Возвращает отчёт: сколько записей добавлено, сколько ошибок с описанием

### Django Admin

Предполагается, что работник HR-отдела ведёт записи в excel, импортирует новые записи в БД, используя возможность импорта excel файла на эндпоинте /api/workers/import/.
Затем, для просмотра записей и работы с ними используеется админ-панель Django, доступная по адресу http://127.0.0.1:8000/admin/.

**Здесь доступны возможности:**
* Фильтры по ключевым полям (is_active, position, hired_date)
* Поиск
* Возможность редактировать некоторые поля прямо из списка (например, is_active)


### 1.Установка и запуск

В терминале клонирйте репозиторий и перейдите в папку с приложением (Ваш компьютер должен быть связан с аккауном Git):

```
(для Windows)
git clone https://github.com/IrinaDemyanenko/employee_management_system.git
cd employee_management_system
```
Установите зависимости, активируйте виртуальное окружение
```
poetry install
poetry shell
```
Перейдите в папку с проектом
```
cd backend
```
После клонирования проекта база данных ещё не создана —
её необходимо подготовить вручную перед запуском сервера.

```
python manage.py makemigrations
python manage.py migrate
```

Создайте суперпользователя
```
python manage.py createsuperuser
```

Запустите сервер разработчика
```
python manage.py runserver
```

### 2.Создание пользователей с разными ролями

В проекте используется стандартная модель пользователя 'AUTH_USER_MODEL'.

- **Обычный пользователь** 'is_staff=False' — может только просматривать сотрудников (GET-запросы) и пользоваться другими безопасными методами HEAD, OPTIONS
- **Администратор** 'is_staff=True' — может добавлять, редактировать и удалять сотрудников.

Пользователь и Работник - разные таблицы.
Чтобы создать пользоваетля с разными ролями, нужно перейти в админ-панель:

```
http://127.0.0.1:8000/admin/auth/user/
```
Создать пользователя через интерфейс и в процессе создания есть возможность поставить галочку 'Staff status'. Роль можно будет позже редактировать.

Второй вариант создания - через терминал:
```
python manage.py shell
```
```
from django.contrib.auth import get_user_model
User = get_user_model()

User.objects.create_user('hr', 'hr@example.com', '1234', is_staff=True)

User.objects.create_superuser('admin', 'admin@example.com', 'admin123')
```


### 3.Запуск тестов

Находясь в директории employee_management_system\backend нужно запустить команду из терминала
```
python manage.py test employees.tests
```
Django автоматически создаст тестовую базу данных
и выполнит все тесты (API, импорт, разрешения, модель и другое).

### 4.Тестирование импорта данных

С запуском тестов (пункт 3) запустится и тестирование импорта данных, но при желание этот тест можно запустить отдельно. Для этого из директории employee_management_system\backend
запустите команду в терминале
```
python manage.py test employees.tests.test_api_import
```

Этот тест проверяет:

- корректную загрузку Excel-файла;

- валидацию обязательных полей;

- проверку email и дублей;

- отчёт, включающий количество созданных записей и список ошибок.

```Пример отчёта в json:
{
  "created": 2,
  "errors_count": 1,
  "errors": [
    "Строка 4 — отсутствуют обязательные поля",
    "Строка 5 — некорректный email (ivan@@example.com)"
  ]
}
